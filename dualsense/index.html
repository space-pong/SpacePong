<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DualSense Rumble Control</title>
</head>
<body>
    <h1>DualSense Controller Rumble Test</h1>
    <button id="connect">Connect Controller</button>
    <button id="rumble">Rumble!</button>
    <button id="stop">Stop Rumble</button>
    <script>
      let device;

      async function connectController() {
          try {
              [device] = await navigator.hid.requestDevice({ filters: [{ vendorId: 0x054c }] });
              if (!device.opened) {
                  await device.open();
                  console.log('Controller connected:', device.productName);
              }
          } catch (error) {
              console.error('Failed to connect the controller:', error);
          }
      }

      async function sendRumble(motorLeft, motorRight) {
          if (!device) {
              console.error('Controller not connected');
              return;
          }
          const reportId = 0x02; // Adjust this ID based on your controller documentation
          const data = new Uint8Array([0xff, motorLeft, motorRight]); // Adjust payload structure as needed
          try {
              await device.sendReport(reportId, data);
              console.log('Rumble command sent');
          } catch (error) {
              console.error('Failed to send rumble command:', error);
          }
      }

      document.getElementById('connect').addEventListener('click', connectController);
      document.getElementById('rumble').addEventListener('click', () => sendRumble(255, 255));
      document.getElementById('stop').addEventListener('click', () => sendRumble(0, 0));
  </script>

</body>
</html>
