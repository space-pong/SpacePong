<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DualSense Rumble Control</title>
</head>
<body>
    <h1>DualSense Controller Rumble Test</h1>
    <button id="connect">Connect Controller</button>
    <button id="rumble">Rumble!</button>
    <button id="stop">Stop Rumble</button>
    <script>
      let device;

      async function connectController() {
          try {
              [device] = await navigator.hid.requestDevice({ filters: [{ vendorId: 0x054c }] });
              if (!device.opened) {
                  await device.open();
                  console.log('Controller connected:', device.productName);
              }
          } catch (error) {
              console.error('Failed to connect the controller:', error);
          }
      }

      async function sendRumble(motorLeft, motorRight) {
          if (!device) {
              console.error('Controller not connected');
              return;
          }
          const reportId = 0x02; // Adjust this ID based on your controller documentation
          const data = new Uint8Array(47).fill(0); // Assuming 3 bytes are needed (this might need adjustment)
          data[0] = 0xff; // Reserved byte or flags, if necessary (may need to be set to a specific value)
          //data[2] = motorRight; // Setting motorRight to 0 to ensure it does not vibrate
          data[3] = motorLeft; // Setting motorRight to 0 to ensure it does not vibrate
          data[1] = 0xf7
          data[38] = 3;
          data[39] = 0x02;
          data[41] = 0x02;
          data[42] = 0xff;
          data[43] = 0x1f;
          data[44] = 0xff;
          data[45] = 0xff;
          data[46] = 0xff;
          try {
              await device.sendReport(reportId, data);
              console.log('Rumble command sent');
          } catch (error) {
              console.error('Failed to send rumble command:', error);
          }
      }

      document.getElementById('connect').addEventListener('click', connectController);
      document.getElementById('rumble').addEventListener('click', () => sendRumble(255, 255));
      document.getElementById('stop').addEventListener('click', () => sendRumble(0, 0));
  </script>

</body>
</html>
